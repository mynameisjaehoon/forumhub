---
title: 프로젝트 Docker로 배포하기
date: 2024-04-08 17:12:00 +09:00
description: >-
    프로젝트를 Docker 컨테이너로 배포하는 과정에 대해서 설명합니다.
categories: [개발, 인프라, 프로젝트]
tags: [백엔드, 메이플 주문서 시뮬레이터]
img:
    path: https://github.com/mynameisjaehoon/mynameisjaehoon.github.io/assets/76734067/9dd04f22-e5dd-4931-a077-23fb0ee02726
---

## 1. Docker를 사용하기로 한 이유

3월 초, 운영하고 있는 서비스를 다른 서버로 이전한 적이 있었다([링크](https://velog.io/@januaryone/%EB%8B%A4%EB%A5%B8-%EC%84%9C%EB%B2%84%EB%A1%9C-%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8-%EC%9D%B4%EC%A0%84%ED%95%98%EA%B8%B0)) 링크에 있는 글을 보면 알수 있지만 새로운 VM에서 프로젝트 환경을 세팅하기 위해서 `git`, `node`, `npm`, `java`등을 설치하고 `Nginx`도 설치해서 웹서버 설정 정보도 다시 적용해주고 SSL을 사용하기 위해서 기존에 사용하던 공개키, 비밀키를 복사해 가져오는 등 여러가지 작업이 필요했다. 당시 처음 서버를 이전해보는 것이라 반나절 쯤 걸렸던 것 같다.

내가 운영하고 있는 서비스는 한달에 2.5만명 정도의 사용자가 있기 때문에 비용이 소모되고 계속해서 서버를 이전하게 되는 것은 필연적이다. 3월초에 서버를 이전하고나서 매번 서버를 이전할 때마다 이런 과정을 거쳐야하는걸까? 라는 생각이 자리잡았다. 반나절을 고생해서 겨우 세팅했는데 이걸 매번 다시해야한다고? 물론 처음할 때와는 다르게 소모되는 시간은 적어지겠지만 그래도 세팅이 번거롭다는 것은 매한가지이다.

이 문제를 해결할 방법을 찾다가 예전에 듣기만 하고 넘겨버린 Docker라는 키워드가 다시 눈에 들어왔다. 그때도 개발환경 세팅을 편하게 해주는 도구 정도로 알고있었다. 그 당시에는 필요가 없었고 원래도 필요하지 않는데 새로운 기술을 사용하는것에 부담감이 있었기 때문에 시도하지 않았다. 하지만 반복해서 개발환경을 세팅해야하는 지금, Docker의 도움이 절실해졌다.

## 2. 프로젝트 환경
내 프로젝트는 Nginx에서 요청을 받아 /api 요청이면 Spring Boot WAS로 요청을 전달하고, 그 이외의 요청은 리액트를 빌드해서 나온 index.html을 응답하는 형식으로 되어었다. Docker를 처음 사용하면서 프로젝트의 도커 컨테이너 구성을 어떻게 해야할지 고민이 되었다. Spring Boot를 빌드해서 나온 jar 파일과 react를 빌드한 결과를 이미지로 담아서 배포해야하나?

처음에는 백엔드와 프론트엔드를 똑같은 도커이미지에 담으면되는 것으로 생각했다. 하지만 하나의 컨테이너에는 하나의 프로세스가 작동하는 것이 좋다고 한다. 그래야 나중에 교체가 필요할 때 원하는 컨테이너만 갈아끼울 수 있다.

![](https://github.com/mynameisjaehoon/mynameisjaehoon.github.io/assets/76734067/4321355d-a195-4661-882b-524992941b40)

위의 그림과는 다르게 Nginx와 React를 다른 도커 컨테이너로 구성해도 된다. 나는 /api로 오는 요청이 아니면 전부 index.html로 이동시키고 싶어씩 때문에 그 과정을 단순화 하기 위해서 Nginx와 react, 빌드결과를 같은 컨테이너 안에 담았다.


## 3. Dockerfile 작성

### 3-1. backend

### 3-2. frontend

## 4. docker compose 작성

## 5. docker compose 빌드

## 6. 도커 허브에 푸시

## 7. 트러블 슈팅


## 참고자료
- [초보자를 위한 도커 안내서 - 도커란 무엇인가?](https://subicura.com/2017/01/19/docker-guide-for-beginners-1.html)
- [Docker로 React, Nginx, Spring Boot 컨테이너 배포하기](https://oozoowos.tistory.com/entry/Docker%EB%A1%9C-React-Nginx-Spring-Boot-%EC%BB%A8%ED%85%8C%EC%9D%B4%EB%84%88-%EB%B0%B0%ED%8F%AC%ED%95%98%EA%B8%B0)