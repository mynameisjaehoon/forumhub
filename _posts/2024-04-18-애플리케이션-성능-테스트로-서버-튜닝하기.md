---
title: 애플리케이션 성능 테스트로 서버 튜닝하기
date: 2024-04-18 18:00:00 +09:00
description: >-
    웹 서버 성능 테스트를 시행하고 튜닝과정에 대해서 설명합니다.
categories: [성능 테스트]
tags: [메이플 주문서 시뮬레이터]
---

## 성능테스트 이유
내가 운영하고 있는 서비스는 일정한 수의 사용자가 꾸준히 사용하는 서비스가 아니다. 게임과 관련된 서비스이기 때문에 게임이 업데이트 되거나 어떤 유튜버가 서비스를 사용하고 올린 영상에 사이트가 노출되었을 때 조회요청이 올라가는 경향이 있다.
![](https://github.com/mynameisjaehoon/mynameisjaehoon.github.io/assets/76734067/34f721cd-2e27-4a88-ab83-5d1658702dd9)
위 차트는 사용자 수를 나타내는 차트이다. 한눈에 봐도 높은 구간이 있는데, 270~80여명 정도의 사용자가 동시에 접속했고 저때 일순간이였지만 응답시간이 굉장히 느려졌다. 피크를 지난 다음에는 조금 완화되었지만 그래도 100여명 정도의 사용자가 동시접속하는 상황이 지속되면서 응답시간이 느려지는 문제가 있었다.

성능테스트를 통해서 최소한 저정도의 트래픽이 들어왔을 때 서버가 다운되지 않고 목표한 만큼의 응답시간을 내고싶었고 그러기 위해서는 웹 애플리케이션 스레드 수를 조절하거나, DB 의 커넥션 수를 조절하거나, 쿼리를 튜닝하는 등의 작업이 필수적이다. 그리고 그 원인을 찾기 위해서 성능테스트를 진행하였다.

성능을 올리는 방법으로는 스레드, 커넥션 수 조절말고도 WAS를 늘리는 Scale-out을 사용할 수 있다. 하지만 또 서버를 늘리기 비용이 부담되어 우선은 Scale-Out은 제쳐두기로 하였다. 여유가 되면 당연히 고려할것이다.

## 성능테스트 도구 선정
많이 사용되는 성능 테스트 도구에는 `JMeter`, `nGrinder`, `PinPoint` 등의 도구가 있다. 처음에는 `nGrinder`를 사용해서 테스트를 진행했다. `nGrinder`를 사용하면 TPS, 평균 응답시간등의 정보를 얻을 수 있다. 하지만 애플리케이션 내부의 문제 발생지점과 병목구간을 확인하기란 어려웠다. 특히나 DBCP 커넥션 수를 조절하려하는데 `nGrinder`만 가지고서는 정말로 데이터베이스와의 통신에 시간이 많이 걸리는 것인지, 아니면 쿼리를 수행하는데 문제가 있는 것인지 정보를 캐치해낼 수 없었기 때문에 커넥션의 갯수를 조절하는데 어려움을 느껴 `PinPoint`의 도움을 받아보기로 하였다.

PinPoint는 애플리케이션의 구성과 각 요소들의 관계를 파악할 수 있도록 보여주고 문제발생 지점과 병목구간을 쉽게 발견하여 문제진단을 더 빠르게할 수 있도록 도와준다.

> TPS, 응답시간 뿐만 아니라 애플리케이션 내부의 병목구간을 더 자세히 알아보기 위해서 `PinPoint`를 선택하였다.
{: .prompt-info }

## 튜닝 목표
꿈은 크게 가지라고 하지 않았던가 현재 MAU는 많을때 3만 정도이지만 목표치를 더 높게 두려고한다. 성능 튜닝의 목표를 어느정도로 잡아야하는가에 대해서는 공식이 존재한다.

> - Throughput: 1일 평균 RPS ~ 1일 최대 RPS
> - (1일 사용자 수(DAU)) * (1명당 1일 평균 접속 수) = 1일 총 접속 수
> - (1일 총 접속 수) / 86,400 = 1일 평균 RPS
> - (1일 평균 RPS) * (최대 트래픽 / 평소 트래픽) = 1일 최대 RPS

위 공식으로 계산했을 때 수용해야하는 Vuser는 25.02로 약 25명정도의 Vuser를 감당할 수 있는 정도면 된다. 그러나 나느 최악의 상황에서도 대비하고 싶고, 실제 눈으로 한번에 200명 이상의 사용자가 접속하는것을 눈으로 목격했기 때문에 공식으로 나온 결과보다 목표치를 상향해서 설정했다. 따라서 Vuser가 최소한 50 정도일 때 100ms의 응답속도를 목표로 하고있다.

> Vuser 50명일 때 100ms의 응답속도
{: .prompt-info }

